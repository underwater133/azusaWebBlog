使用脚手架是vite。需求是将项目部署到xxx.com/app/目录下。
一开始什么都没有配置，base(如果是vue.config.js则是对应publicPath)是默认的，路由使用的是histroy，规则如下：
```js
const routes = [
  { path: '/', component: () => import('@/views/Home.vue')},
  { path: '/About', component: () => import('@/views/About.vue')},
]
```
当时我的理解是，部署的时候将打包后的文件放在/app/目录下，那么访问xxx.com/app就能匹配到对应的路由（被这里坑了很久）。

当项目部署后，首先是出现两个文件404问题，分别是@vite/client.js和main.js。

当时在网上看到的解决方法是把base修改成'./'，也就是相对路径，修改完一部署，果然没报404了，但是页面一片空白，并且控制台也没有任何报错。

这就奇怪了，明明已经加载了main.js部分的内容，但却没有渲染出组件（这这里有考虑到路由的问题，但当时认为是nginx没配置好）。然后就在同事的nginx上部署了一下，发现是可以正常访问的，但他的情况是没有加上子路径的，一加上/app就不行了。其实到这里基本可以确定是路由规则的问题了，但当时钻牛角尖了以为是nginx没配好。

后面试了许多方案，整合了两种情况：

情况1：
```
nginx
server {
    # xxx其他配置

    listen       80;
    server_name  localhost;

    location /app/ {
      alias xxx/nginx-1.20.2/html/app/;
      try_files $uri $uri/ /app/index.html;
    }

    # xxx其他配置
}

vite.config.js
base: '/app'

routes
const routes = [
  { path: '/app/', component: () => import('@/views/Home.vue')},
  { path: '/app/mobile', component: () => import('@/views/About.vue')},
]
```
两个页面都能正常访问，经过测试发现，base需要和location保持一致（后面发现不一定，base使用相对路径也是可以的），而文件存放的路径不是关键，即使修改也正常访问到：
```
nginx
server {
    listen       80;
    server_name  localhost;
    location /app/ {
      # 目录名修改为dist
      alias xxx/nginx-1.20.2/html/dist/;
      try_files $uri $uri/ /dist/index.html;
    }
}
```
但是如果你把location修改为不和base一致（实际应该是如果不和路由前缀一致），则会出现404的情况。

情况2：
那么我最开始设置成的base为'./'时，没有渲染组件是什么情况呢？
```
nginx
server {
    listen       80;
    server_name  localhost;

    location /app/ {
      alias xxx/nginx-1.20.2/html/app/;
      try_files $uri $uri/ /app/index.html;
    }
}

vite.config.js
base: './'

routes
const routes = [
  { path: '/', component: () => import('@/views/Home.vue')},
  { path: '/mobile', component: () => import('@/views/About.vue')},
]
```
经过测试，确实是因为路由规则不对导致的，如果路由规则修改为如下：
```
const routes = [
  { path: '/app', component: () => import('@/views/Home.vue')},
  { path: '/app/mobile', component: () => import('@/views/About.vue')},
]
```
则可以正常运行，说明情况1说的base要与location一致并不一定，而是要保证路由和location要匹配的上。

此外，看到有人说需要配置router中的base，会自动为路由加上前缀，如下：
```
const routes = [
  { path: '/', component: () => import('@/views/Home.vue')},
  { path: '/mobile', component: () => import('@/views/About.vue')},
]

const router = createRouter({
  history: createWebHistory(),
  base: '/app',
  routes,
})
```
但我试了却没有生效，加与不加，访问localhost/app都是空白页面，且不报错，说明就是没有匹配到对应的路由。


其中如果你某些地方没配置好还会出现访问localhost/app正常，localhost/app/mobile出现404的问题，可以检查下前端和nginx有没有对应配好。

总结
如果使用history模式，并且需要部署到子级目录下配置好以下内容：
vite.config.js的base(vue.config.js对应publicPath)需要设置成'./'或者服务器存放资源的路径，否则出现404；
nginx配置如下：
```
server {
    listen       80;
    server_name  localhost;

    location /app/ {
      alias xxx/nginx-1.20.2/html/app/;
      try_files $uri $uri/ /app/index.html;
    }
}
```
alias就是匹配到location后去对应路径下找资源，try_files则是在匹配不到完去适配的location时会去使用的资源。例如这里没有配置/app/About，但是却可以访问到就是因为这条配置，如果删掉则会出现404，这是因为单页面应用只有一个入口文件，所以可以这么做。
route规则中的路径前缀需要与location一致。

这三点如果都没错的话应该就能正确部署了。