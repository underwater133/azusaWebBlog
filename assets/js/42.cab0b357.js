(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{504:function(s,n,a){"use strict";a.r(n);var t=a(2),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),n("p",[s._v("废话不多说，目的是将项目部署到"),n("code",[s._v("xxx.com/app")]),s._v("路径下。\n脚手架用的是vite，一开始什么都没有配置，base(如果是vue.config.js则是对应publicPath)是默认的（根目录），路由模式使用的是histroy，规则大致如下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" routes "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("component")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@/views/Home.vue'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/About'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("component")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@/views/About.vue'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("当时我的理解是，部署的时候将打包后的文件放在"),n("code",[s._v("/app/")]),s._v("目录下，那么访问"),n("code",[s._v("xxx.com/app")]),s._v("就能匹配到对应的路由。")]),s._v(" "),n("p",[s._v("当项目部署后，首先是出现两个文件404问题，分别是@vite/client.js和main.js。")]),s._v(" "),n("p",[s._v("当时在网上看到的解决方法是把base修改成'./'，也就是相对路径，修改完一部署，果然没报404了，但是页面一片空白，并且控制台也没有任何报错（这时候并不知道nginx的配置和资源在服务器存放的路径）。")]),s._v(" "),n("p",[s._v("这就奇怪了，明明已经加载了main.js部分的内容，但却没有渲染出组件。然后就在同事的nginx上部署了一下，发现是可以正常访问的，但他的情况是没有加上子路径的，一加上"),n("code",[s._v("/app")]),s._v("就不行了。其实这里就大致知道是nginx配置与前端打包配置没有配合好的原因了。")]),s._v(" "),n("h2",{attrs:{id:"解决方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[s._v("#")]),s._v(" 解决方法")]),s._v(" "),n("p",[s._v("后面了解了nginx的配置，试了许多方案，终于配置好了：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("nginx conf\nserver {\n    # xxx其他配置\n\n    listen       80;\n    server_name  xxx.com;\n\n    location /app {\n      alias xxx/nginx-1.20.2/html/app/;\n      try_files $uri $uri/ /app/index.html;\n    }\n\n    # xxx其他配置\n}\n\nvite.config.js\nbase: '/app'\n\nroutes\nconst routes = [\n  { path: '/app/', component: () => import('@/views/Home.vue')},\n  { path: '/app/About', component: () => import('@/views/About.vue')},\n]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("两个页面都能正常访问，经过测试发现，base需要和location保持一致（后面发现不一定，base可以有多种写法），而文件存放的路径不是关键，即使修改也可以正常访问到（文件需要放到对应的目录下）：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("nginx\nserver {\n    listen       80;\n    server_name  xxx.com;\n    location /app {\n      # 将前端打包文件放到dist目录下\n      alias xxx/nginx-1.20.2/html/dist/;\n      try_files $uri $uri/ /dist/index.html;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("那么我最开始设置成的base为'./'时，没有渲染组件是什么情况呢？")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("nginx\nserver {\n    listen       80;\n    server_name  xxx.com;\n\n    location /app {\n      alias xxx/nginx-1.20.2/html/app/;\n      try_files $uri $uri/ /app/index.html;\n    }\n}\n\nvite.config.js\nbase: './'\n\nroutes\nconst routes = [\n  { path: '/', component: () => import('@/views/Home.vue')},\n  { path: '/About', component: () => import('@/views/About.vue')},\n]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("现在看来，确实是因为路由规则不对导致的，如果路由规则修改为如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const routes = [\n  { path: '/app', component: () => import('@/views/Home.vue')},\n  { path: '/app/About', component: () => import('@/views/About.vue')},\n]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("则可以正常访问，说明base不一定要与location一致，而是要保证路由前缀和location要匹配的上。")]),s._v(" "),n("p",[s._v("此外，看到有人说需要配置router中的base，会自动为路由加上前缀，如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const routes = [\n  { path: '/', component: () => import('@/views/Home.vue')},\n  { path: '/About', component: () => import('@/views/About.vue')},\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  base: '/app',\n  routes,\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("但我试了却没有生效，加与不加，访问"),n("code",[s._v("xxx.com/app")]),s._v("都是空白页面，且不报错，说明就是没有匹配到对应的路由，可能还是我的写法有问题？")]),s._v(" "),n("p",[s._v("其中如果你某些地方没配置好还会出现访问"),n("code",[s._v("xxx.com/app")]),s._v("正常，"),n("code",[s._v("xxx.com/app/About")]),s._v("出现404的问题，可以检查下前端和nginx有没有对应配好。")]),s._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("p",[s._v("如果使用history模式，并且需要部署到子级目录下，需要配置好以下内容：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("vite.config.js的base(vue.config.js对应publicPath)可以有三种设置方式：相对路径"),n("code",[s._v("'./'")]),s._v("、服务器存放资源的路径、nginx配置文件location的路径，设置有误可能出现404。")])]),s._v(" "),n("li",[n("p",[s._v("nginx配置如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n    listen       80;\n    server_name  xxx.com;\n\n    location /app {\n      alias xxx/nginx-1.20.2/html/app/;\n      try_files $uri $uri/ /app/index.html;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("alias就是匹配到location后去对应路径下找资源，try_files则是在url前缀包含location但却没有匹配的资源时会去使用的资源。")]),s._v(" "),n("p",[s._v("例如这里location没有配置"),n("code",[s._v("/app/About")]),s._v("，但是却可以访问到就是因为这条配置，如果删掉则会出现404，这是因为单页面应用只有一个入口文件，所以可以这么做。")])]),s._v(" "),n("li",[n("p",[s._v("route规则中的路径前缀需要与location一致。")])])]),s._v(" "),n("p",[s._v("这三点如果都没错的话应该就能正确部署了，"),n("strong",[s._v("推荐base、路由前缀、location三者统一")]),s._v("，方便配置，也可以减少出错。另外，前端打包后的文件也推荐放到对应级别的目录中，如在本例子中，存放的位置为"),n("code",[s._v("/xxx/nginx/html/app/")]),s._v("。")]),s._v(" "),n("h2",{attrs:{id:"其他"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[s._v("#")]),s._v(" 其他")]),s._v(" "),n("p",[s._v("当你base设置为资源的绝对路径时（如"),n("code",[s._v("/dist")]),s._v("），如果你跑本地服务的话，可能会访问不到资源，但是打包后部署上去是可以正常访问的。")]),s._v(" "),n("p",[s._v("看到网上有人说使用base使用'./'会出现刷新404的情况，但我这边没有遇到，如果大家遇到可以说明一下情况，共同探讨。")]),s._v(" "),n("p",[s._v("对于单页面应用，location路径的最后可以不带/。这样的好处是，假如你想要部署的地址是"),n("code",[s._v("xxx.com/app")]),s._v("，那么你使用"),n("code",[s._v("xxx.com/app")]),s._v("或者"),n("code",[s._v("xxx.com/app/")]),s._v("都可以访问到，这是因为配置了try_files，即使找不到，但是由于前缀匹配到了location，可以去寻找默认的文件；")]),s._v(" "),n("p",[s._v("如果location最后携带了"),n("code",[s._v("/")]),s._v("，则"),n("code",[s._v("xxx.com/app")]),s._v("访问不到。这是因为location最后加了"),n("code",[s._v("/")]),s._v("需要精确匹配到"),n("code",[s._v("xxx.com/app/")]),s._v("前缀才能访问。\n当然这也要根据项目需求来决定如何配置。")]),s._v(" "),n("p",[s._v("最后，这是本人初次接触nginx部署，如果有说的不对的地方欢迎指出，共同进步。")])])}),[],!1,null,null,null);n.default=e.exports}}]);