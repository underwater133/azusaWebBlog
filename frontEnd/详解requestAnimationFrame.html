<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>详解 requestAnimationFrame | Azusa的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/azusaWebBlog/YeaMiko.png">
    <script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?e072087a21b1865aa670ebe1fe0b6bcb";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script>
    <meta name="description" content="Welcome to my blog">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/azusaWebBlog/assets/css/0.styles.9b279e47.css" as="style"><link rel="preload" href="/azusaWebBlog/assets/js/app.c070b236.js" as="script"><link rel="preload" href="/azusaWebBlog/assets/js/3.4b10ef19.js" as="script"><link rel="preload" href="/azusaWebBlog/assets/js/1.be302be5.js" as="script"><link rel="preload" href="/azusaWebBlog/assets/js/13.1a7b1970.js" as="script"><link rel="prefetch" href="/azusaWebBlog/assets/js/10.91ed6d23.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/11.c7257ba9.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/12.71fb7737.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/14.b42e4ce7.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/15.2d672ad9.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/16.e53a827d.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/17.7088602a.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/18.ac50cb1d.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/19.238ba396.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/20.40c11c1a.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/21.4e61921c.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/22.3e5aa961.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/23.2cde9637.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/24.1ecaf8ff.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/25.00844611.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/26.ce8c50f6.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/27.9b347b50.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/28.2d7d66d5.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/29.07dea86c.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/30.f2222f67.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/31.fa4d9498.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/32.40c5a47c.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/33.0d3a1f41.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/34.f50bb112.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/35.c66a55be.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/36.49d2f394.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/37.45f45e75.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/38.0766753c.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/39.03760cdb.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/4.591b6133.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/40.c5914e5f.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/41.3d5e46e8.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/42.4b20b01e.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/43.b1c61055.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/44.9fcc9e73.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/45.ffa93969.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/46.77b35195.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/47.5fcaf8aa.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/48.fea8ef24.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/49.21968d89.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/5.0e7b4fcd.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/50.7d01e0ea.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/51.968e7d0a.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/52.f42a06e4.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/53.fd084d1d.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/54.6ef6d1ef.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/55.1477837f.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/56.66a65542.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/6.fed335f9.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/7.8e706732.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/8.88964e07.js"><link rel="prefetch" href="/azusaWebBlog/assets/js/9.6f7d1373.js">
    <link rel="stylesheet" href="/azusaWebBlog/assets/css/0.styles.9b279e47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Azusa的博客</h3> <p class="description" data-v-59e6cb88>Welcome to my blog</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Azusa</span>
          
        <span data-v-59e6cb88>2023 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/azusaWebBlog/" class="home-link router-link-active"><img src="/azusaWebBlog/YeaMiko.png" alt="Azusa的博客" class="logo"> <span class="site-name">Azusa的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/azusaWebBlog/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/前端随笔/" class="nav-link"><i class="undefined"></i>
  前端随笔
</a></li><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/React/" class="nav-link"><i class="undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/力扣/" class="nav-link"><i class="undefined"></i>
  力扣
</a></li><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/其他/" class="nav-link"><i class="undefined"></i>
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/azusaWebBlog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/azusaWebBlog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/underwater133" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_45732455" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://space.bilibili.com/11340406" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bilibili"></i>
  Bilibili
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/azusaWebBlog/Ayaka.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Azusa
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>46</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>42</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/azusaWebBlog/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/前端随笔/" class="nav-link"><i class="undefined"></i>
  前端随笔
</a></li><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/React/" class="nav-link"><i class="undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/力扣/" class="nav-link"><i class="undefined"></i>
  力扣
</a></li><li class="dropdown-item"><!----> <a href="/azusaWebBlog/categories/其他/" class="nav-link"><i class="undefined"></i>
  其他
</a></li></ul></div></div><div class="nav-item"><a href="/azusaWebBlog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/azusaWebBlog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/underwater133" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_45732455" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://space.bilibili.com/11340406" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bilibili"></i>
  Bilibili
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>详解 requestAnimationFrame</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Azusa</span>
          
        <span data-v-59e6cb88>2023 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">详解 requestAnimationFrame</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Azusa</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023/4/12</span></i> <i class="iconfont reco-eye" data-v-8a445198><span id="/azusaWebBlog/frontEnd/%E8%AF%A6%E8%A7%A3requestAnimationFrame.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-8a445198><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>前端</span><span class="tag-item" data-v-8a445198>动画</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>这两天在学 canvas，刚好看到有地方使用了 requestAnimationFrame 这个方法，其实之前我也见过这个东西，与动画渲染有关，但没深入了解。既然再次碰到了，就认真学习一下用法。</p> <h2 id="早期定时动画"><a href="#早期定时动画" class="header-anchor">#</a> 早期定时动画</h2> <p>在没有这个 api 之前，js是如何制作动画的呢？答案是使用 setTimeout 和 setInterval 这两个定时器，相信大家也不陌生。但了解过事件循环的应该知道，这两个定时器并不能保证时间精度，他们只是在规定的时间后将回调函数添加到任务队列中，并不能保证回调按时执行。</p> <p>并且，为了使得动画可以流畅展示，对于定时的要求也比较严格。一般 60 帧我们看起来就是比较舒服的，那么重绘的时间间隔应该是 1000毫秒/60，约为 17 毫秒。也就是在时间精度极高的情况下，重绘间隔为 17 毫秒才能让动画看起来平滑。</p> <h2 id="requestanimationframe"><a href="#requestanimationframe" class="header-anchor">#</a> requestAnimationFrame</h2> <p>除了重绘间隔的要求，浏览器的时间精度也是很重要的，但由于各个浏览器的时间精度不一并且精度不能满足动画平滑渲染的要求，并且浏览器还对切换到后台和不活跃的签页中定时器执行限流，所以才有了 requestAnimationFrame。</p> <p>Mozilla 的 Robert O’Callahan 提出了一个方案，创造一个名为 mozrequestAnimationFrame 的新方法，用来通知浏览器某些 JavaScript 代码要执行动画了，这样浏览器就可以在运行某些代码后进行适当的优化，随着这个方案的发展，现在已经能在各个浏览器使用没有前缀的版本了，也就是 requestAnimationFrame。</p> <p>requestAnimationFrame 接收一个参数，这个参数是一个要在重绘屏幕之前调用的函数。这个函数就是修改 DOM 样式以反映下一次重绘有什么变化的地方。</p> <p>下面是一个展示进度条的例子：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>process<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span> <span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">var</span> process <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'process'</span><span class="token punctuation">)</span>
    <span class="token keyword">function</span> <span class="token function">updateProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMilliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        process<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token string">'px'</span>
        a<span class="token operator">++</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateProcess<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateProcess<span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>运行的动画就不看了，很平滑，我们主要来看打印的日志：
<img src="/azusaWebBlog/assets/img/1681309689897.82d50109.jpg"></p> <p>我们可以发现大约每 7 毫秒打印一次，也就是动画执行了一次。那这里为什么是 7 呢？其实和显示器的刷新频率有关，下图是我屏幕的刷新频率：</p> <img src="data:image/jpeg;base64,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"> <p>大概是 144hz，那么 1000 / 144 等于 6.94444...，约等于 7。看到这里就明白了，这个 requestAnimationFrame 还真精准，动画的平滑程度再不依赖于定时器的延时了，而是通过屏幕的刷新率决定的。</p> <p>到这里，requestAnimationFrame 已经解决了浏览器不知道 js 动画什么时候开始以及最佳时间间隔是多少的问题了，但还有一个问题没解决，就是不知道自己的代码何时实际执行。其实 requestAnimationFrame 也给出了解决方案。</p> <p>传递给 requestAnimationFrame 的函数实际上可以接收一个参数，此参数是一个 DOMHighResTimeStamp 的实例，表示下次重绘的时间。如果给出了精确的时间值，那么开发者也可以更好决定如何调优了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(new Date().getMilliseconds())</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span> <span class="token comment">// 打印接收的参数</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    process<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token string">'px'</span>
    a<span class="token operator">++</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateProcess<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>结果如下，可以看到间隔都是 7 毫秒左右：
<img src="/azusaWebBlog/assets/img/1681310972455.770e8bdf.jpg"></p> <h2 id="cancelanimationframe"><a href="#cancelanimationframe" class="header-anchor">#</a> cancelAnimationFrame</h2> <p>和 setTimeout 以及 setInterval 一样，requestAnimationFrame 也会返回一个 id，我们可以基于此 id 来取消重绘任务，这里就不展示了，用法和 clearTimeout 一样。</p> <h2 id="通过-requestanimationframe-节流"><a href="#通过-requestanimationframe-节流" class="header-anchor">#</a> 通过 requestAnimationFrame 节流</h2> <p>之前我们知道可以通过 setTimeout 来节流，以免大量执行大量重复的代码。但如果这些代码中包含修改 dom 样式的代码，我们想把事件处理程序的调用限制在每次重绘之前，可以通过 requestAnimationFrame 设置。</p> <p>例如比较常见的滚动监听，我们一般都使用 setTimeout，在此基础上我们把 requestAnimationFrame 塞进来。通过这种方法，setTimeout 可以限制回调的执行次数，而 requestAnimationFrame 可以控制在浏览器的哪个渲染周期中去执行。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> enabled <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token keyword">function</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    enabled <span class="token operator">=</span> <span class="token boolean">false</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token comment">// 限制 50 ms执行一次。</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>现在看来，vue 中的 nextTick 这个钩子应该是用到了这个方法（待我有空去考察一下），之前面试都没扯到这里，只说到了事件循环。</p> <p>本次学习 requestAnimationFrame 就到这里了，希望有帮助到你。</p> <p>有任何问题欢迎评论和我交流哦~</p> <p>参考：《JavaScript高级程序设计》(第4版)</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2024/9/3 14:56:35</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/azusaWebBlog/frontEnd/%E8%AF%A6%E8%A7%A3requestAnimationFrame.html#前言" class="sidebar-link reco-side-前言" data-v-b57cc07c>前言</a></li><li class="level-2" data-v-b57cc07c><a href="/azusaWebBlog/frontEnd/%E8%AF%A6%E8%A7%A3requestAnimationFrame.html#早期定时动画" class="sidebar-link reco-side-早期定时动画" data-v-b57cc07c>早期定时动画</a></li><li class="level-2" data-v-b57cc07c><a href="/azusaWebBlog/frontEnd/%E8%AF%A6%E8%A7%A3requestAnimationFrame.html#requestanimationframe" class="sidebar-link reco-side-requestanimationframe" data-v-b57cc07c>requestAnimationFrame</a></li><li class="level-2" data-v-b57cc07c><a href="/azusaWebBlog/frontEnd/%E8%AF%A6%E8%A7%A3requestAnimationFrame.html#cancelanimationframe" class="sidebar-link reco-side-cancelanimationframe" data-v-b57cc07c>cancelAnimationFrame</a></li><li class="level-2" data-v-b57cc07c><a href="/azusaWebBlog/frontEnd/%E8%AF%A6%E8%A7%A3requestAnimationFrame.html#通过-requestanimationframe-节流" class="sidebar-link reco-side-通过-requestanimationframe-节流" data-v-b57cc07c>通过 requestAnimationFrame 节流</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/azusaWebBlog/assets/js/app.c070b236.js" defer></script><script src="/azusaWebBlog/assets/js/3.4b10ef19.js" defer></script><script src="/azusaWebBlog/assets/js/1.be302be5.js" defer></script><script src="/azusaWebBlog/assets/js/13.1a7b1970.js" defer></script>
  </body>
</html>
